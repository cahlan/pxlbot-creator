<!DOCTYPE html>
<html>
<head>
    <title></title>
    <!--
    <script type="text/javascript" src="jquery-ui/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="jquery-ui/ui/jquery.ui.core.js"></script>
    <script type="text/javascript" src="jquery-ui/ui/jquery.ui.draggable.js"></script>
    -->
    <!-- Enable saving canvas -->
    <script src="http://www.nihilogic.dk/labs/canvas2image/canvas2image.js"></script>
    <!-- jQuery stuff -->
    <script type="text/javascript"
            src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript"
            src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css"
          href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css"/>
	<link rel="stylesheet" type="text/css"
          href="css/pxlbot.css"/>
    <script type="text/javascript" src="jquery.idTabs.min.js"></script>
</head>
<script type="text/javascript">
    $(function(){
        $("#ani1").hide();
        var selected_img = null;
        var spacing = 5;
        var spacing = 6;
        a = 0;
        var images_on_stage = [];
        var done_loading_images = false;
        var drag_images = function(selector) {
            if (!!!selector) {
                selector = "img";
            }
            $(selector).draggable({
                start: function(event, ui) {
                    if (images_on_stage.indexOf($(this).attr('id')) < 0) {
                        //switches parent node so we don't lost it when they switch tab ...

                        var index = $(this).index();

                        var new_img = $(this).clone();
                        new_img.insertAfter($(this));
                        drag_images(new_img);

                        $(this).appendTo(".theCanvas");
                        $(this).attr('id', 'img_stage__'+images_on_stage.length);

                        images_on_stage.push($(this).attr('id'));
                    }
                    $(this).css("z-index", images_on_stage.length);
                },
                stop: function(event, ui) {
                    //console.log("stopped");
                },
                drag: function(event, ui) {
                    var y = ui.position.top;
                    y = y - y%spacing;
                    ui.position.top = y;
                    var x = ui.position.left;
                    x = x - x%spacing;
                    ui.position.left = x;
                }
            });
            $(selector).keydown(function(evt) {
                var x = parseFloat($(this).css('left')) || 0;
                var y = parseFloat($(this).css('top')) || 0;
                switch (evt.keyCode) {
                    case 37:
                        x -= spacing;
                    break;
                    case 38:
                        y -= spacing;
                    break;
                    case 39:
                        x += spacing;
                    break;
                    case 40:
                        y += spacing;
                    break;
                }
                $(this).css('top', y+'px');
                $(this).css('left', x+'px');
            });
        }

        var load_image = function(path) {
            var img = $('<img />').appendTo('body');
            img.hide();
            img.error(function(e) {
                $(this).remove();
                console.log("image not found, moving to next part class...");
                curr_path_index++;
                if(curr_path_index >= pieces.length) {
                    curr_path_index = 0;
                    //do nothing, we're done!
                    console.log("done loading images");
                    var c = 0;
                    for (var i in all_images) {
                        all_images[c].attr('tabindex', c.toString());
                        c++;
                    }
                    drag_images();
                    $("#ani1").fadeIn();
                    done_loading_images = true;
                }
                else {
                    if (!done_loading_images) {
                        index = 0;
                        load_next_image();
                    }
                }
            });
            img.load(function(evt) {
                //move image to right div
                var i = $(evt.currentTarget);
                $('.'+pieces[curr_path_index]+'s').append(i);
                i.show();
                //console.log("added image to ", '.'+pieces[curr_path_index]+'s')
                all_images.push(i);
                if (!done_loading_images) {
                    load_next_image();
                }
            });
            img.attr('src', path);
        }

        var all_images = [];
        var curr_path_index = 0;
        var index = 0;
        var continue_loading_images = true;
        var load_next_image = function() {
            if (continue_loading_images) {
                index++;
                load_image('imgs/'+pieces[curr_path_index]+'_'+index+'.png');
            }
        }
        console.log("LOADING IMAGES");
        load_next_image();


    });

</script>

<body>
<div class="theCanvas" style="background-color: #eee; height: 400px;">&nbsp;
</div>
<!-- Begin tab code -->
<div id="adv2"> 
  <ul class="idTabs">
    <li><a href="#ani1" class="selected">Arms</a></li> 
    <li><a href="#ani2">Legs</a></li> 
    <li class="split"></li> 
    <li><a href="#ani3">Connectors</a></li> 
    <li><a href="#ani4">Torso</a></li> 
  </ul>
</div>
<div style="clear: both; margin-top:20px;">
</div>

<script type="text/javascript">
    $("#adv2").idTabs(function(id){
        $(id).fadeIn();
        return true;
    });
</script>

</body>
</html>